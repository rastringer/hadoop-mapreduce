# Hadoop MapReduce examples
# Find movie review data here:
# http://media.sundog-soft.com/hadoop/u.data

from mrjob.job import MRJob
from mrjob.step import MRStep

class RatingsBreakdown(MRJob):
    def steps(self):
        return [

            MRStep(mapper=self.mapper_get_ratings,
                   reducer=self.reducer_count_ratings),
            # Sum of movie counts = key, movieID = value
            MRStep(reducer=self.reducer_sorted_output)
        ]

    def mapper_get_ratings(self, _, line):
        (userID, movieID, rating, timestamp) = line.split('\t')
        # Aggregate on key (movieID in this case)
        yield movieID, 1

    def reducer_count_ratings(self, key, values):
        # Add list of 1s, convert to string, zero fill to avoid type errors
        yield str(sum(values)).zfill(5), key

    def reducer_sorted_output(self, count, movies):
        # Iteration
        for movie in movies:
            yield movie, count

if __name__ == '__main__':
    RatingsBreakdown.run()

# The most popular (by the largest number of ratings)
# "50"    "00584"
# Any guesses?
# Star Wars

# Output:
# "1149"  "00026"
# "1160"  "00026"
# "1218"  "00026"
# "1240"  "00026"
# "1284"  "00026"
# "253"   "00026"
# "352"   "00026"
# "398"   "00026"
# "422"   "00026"
# "6"     "00026"
# "775"   "00026"
# "800"   "00026"
# "836"   "00026"
# "966"   "00026"
# "1034"  "00027"
# "1070"  "00027"
# "1170"  "00027"
# "348"   "00027"
# "389"   "00027"
# "457"   "00027"
# "46"    "00027"
# "464"   "00027"
# "564"   "00027"
# "613"   "00027"
# "645"   "00027"
# "681"   "00027"
# "734"   "00027"
# "805"   "00027"
# "842"   "00027"
# "905"   "00027"
# "978"   "00027"
# "1042"  "00028"
# "1109"  "00028"
# "1129"  "00028"
# "1152"  "00028"
# "1411"  "00028"
# "279"   "00028"
# "309"   "00028"
# "362"   "00028"
# "388"   "00028"
# "460"   "00028"
# "571"   "00028"
# "972"   "00028"
# "1061"  "00029"
# "1095"  "00029"
# "1115"  "00029"
# "1136"  "00029"
# "1137"  "00029"
# "563"   "00029"
# "572"   "00029"
# "719"   "00029"
# "764"   "00029"
# "1133"  "00030"
# "1215"  "00030"
# "1220"  "00030"
# "308"   "00030"
# "537"   "00030"
# "608"   "00030"
# "843"   "00030"
# "950"   "00030"
# "1019"  "00031"
# "1023"  "00031"
# "110"   "00031"
# "1194"  "00031"
# "349"   "00031"
# "368"   "00031"
# "383"   "00031"
# "500"   "00031"
# "605"   "00031"
# "630"   "00031"
# "738"   "00031"
# "779"   "00031"
# "797"   "00031"
# "808"   "00031"
# "995"   "00031"
# "1018"  "00032"
# "1022"  "00032"
# "1033"  "00032"
# "1126"  "00032"
# "1132"  "00032"
# "1226"  "00032"
# "426"   "00032"
# "580"   "00032"
# "765"   "00032"
# "774"   "00032"
# "936"   "00032"
# "940"   "00032"
# "974"   "00032"
# "989"   "00032"
# "1139"  "00033"
# "1267"  "00033"
# "573"   "00033"
# "641"   "00033"
# "78"    "00033"
# "878"   "00033"
# "990"   "00033"
# "372"   "00034"
# "586"   "00034"
# "612"   "00034"
# "653"   "00034"
# "680"   "00034"
# "723"   "00034"
# "829"   "00034"
# "882"   "00034"
# "922"   "00034"
# "925"   "00034"
# "961"   "00034"
# "971"   "00034"
# "1020"  "00035"
# "1059"  "00035"
# "266"   "00035"
# "522"   "00035"
# "567"   "00035"
# "644"   "00035"
# "979"   "00035"
# "1244"  "00036"
# "670"   "00036"
# "796"   "00036"
# "856"   "00036"
# "1008"  "00037"
# "1090"  "00037"
# "30"    "00037"
# "364"   "00037"
# "41"    "00037"
# "583"   "00037"
# "783"   "00037"
# "937"   "00037"
# "1013"  "00038"
# "1021"  "00038"
# "1089"  "00038"
# "1134"  "00038"
# "1210"  "00038"
# "637"   "00038"
# "646"   "00038"
# "1060"  "00039"
# "1217"  "00039"
# "1221"  "00039"
# "16"    "00039"
# "370"   "00039"
# "373"   "00039"
# "503"   "00039"
# "585"   "00039"
# "622"   "00039"
# "623"   "00039"
# "731"   "00039"
# "743"   "00039"
# "752"   "00039"
# "785"   "00039"
# "874"   "00039"
# "951"   "00039"
# "1044"  "00040"
# "43"    "00040"
# "57"    "00040"
# "611"   "00040"
# "639"   "00040"
# "697"   "00040"
# "802"   "00040"
# "819"   "00040"
# "929"   "00040"
# "932"   "00040"
# "943"   "00040"
# "945"   "00040"
# "1051"  "00041"
# "1063"  "00041"
# "1110"  "00041"
# "330"   "00041"
# "350"   "00041"
# "355"   "00041"
# "547"   "00041"
# "577"   "00041"
# "610"   "00041"
# "771"   "00041"
# "963"   "00041"
# "107"   "00042"
# "1098"  "00042"
# "769"   "00042"
# "844"   "00042"
# "872"   "00042"
# "900"   "00042"
# "902"   "00042"
# "1050"  "00043"
# "1091"  "00043"
# "261"   "00043"
# "336"   "00043"
# "379"   "00043"
# "407"   "00043"
# "540"   "00043"
# "589"   "00043"
# "620"   "00043"
# "809"   "00043"
# "890"   "00043"
# "944"   "00043"
# "1010"  "00044"
# "1025"  "00044"
# "1067"  "00044"
# "1142"  "00044"
# "1188"  "00044"
# "224"   "00044"
# "539"   "00044"
# "575"   "00044"
# "638"   "00044"
# "656"   "00044"
# "688"   "00044"
# "694"   "00044"
# "761"   "00044"
# "846"   "00044"
# "896"   "00044"
# "975"   "00044"
# "984"   "00044"
# "1079"  "00045"
# "1197"  "00045"
# "236"   "00045"
# "329"   "00045"
# "552"   "00045"
# "728"   "00045"
# "810"   "00045"
# "881"   "00045"
# "942"   "00045"
# "952"   "00045"
# "1046"  "00046"
# "1135"  "00046"
# "251"   "00046"
# "444"   "00046"
# "524"   "00046"
# "664"   "00046"
# "671"   "00046"
# "760"   "00046"
# "794"   "00046"
# "921"   "00046"
# "941"   "00046"
# "956"   "00046"
# "1007"  "00047"
# "1118"  "00047"
# "339"   "00047"
# "363"   "00047"
# "366"   "00047"
# "789"   "00047"
# "876"   "00047"
# "1228"  "00048"
# "244"   "00048"
# "365"   "00048"
# "456"   "00048"
# "467"   "00048"
# "562"   "00048"
# "674"   "00048"
# "841"   "00048"
# "948"   "00048"
# "406"   "00049"
# "541"   "00049"
# "683"   "00049"
# "772"   "00049"
# "824"   "00049"
# "833"   "00049"
# "955"   "00049"
# "977"   "00049"
# "1017"  "00050"
# "139"   "00050"
# "206"   "00050"
# "297"   "00050"
# "490"   "00050"
# "570"   "00050"
# "602"   "00050"
# "649"   "00050"
# "686"   "00050"
# "806"   "00050"
# "542"   "00051"
# "614"   "00051"
# "712"   "00051"
# "749"   "00051"
# "342"   "00052"
# "466"   "00052"
# "489"   "00052"
# "768"   "00052"
# "877"   "00052"
# "1065"  "00053"
# "441"   "00053"
# "702"   "00053"
# "840"   "00053"
# "849"   "00053"
# "875"   "00053"
# "886"   "00053"
# "892"   "00053"
# "102"   "00054"
# "396"   "00054"
# "535"   "00054"
# "675"   "00054"
# "721"   "00054"
# "76"    "00054"
# "344"   "00055"
# "369"   "00055"
# "413"   "00055"
# "847"   "00055"
# "395"   "00056"
# "494"   "00056"
# "813"   "00056"
# "142"   "00057"
# "27"    "00057"
# "40"    "00057"
# "502"   "00057"
# "512"   "00057"
# "754"   "00057"
# "770"   "00057"
# "827"   "00057"
# "931"   "00057"
# "166"   "00058"
# "632"   "00058"
# "716"   "00058"
# "722"   "00058"
# "741"   "00058"
# "85"    "00058"
# "898"   "00058"
# "923"   "00058"
# "1119"  "00059"
# "391"   "00059"
# "492"   "00059"
# "495"   "00059"
# "561"   "00059"
# "581"   "00059"
# "61"    "00059"
# "615"   "00059"
# "737"   "00059"
# "880"   "00059"
# "158"   "00060"
# "278"   "00060"
# "493"   "00060"
# "609"   "00060"
# "939"   "00060"
# "140"   "00061"
# "946"   "00061"
# "1041"  "00062"
# "254"   "00062"
# "414"   "00062"
# "499"   "00062"
# "450"   "00063"
# "481"   "00063"
# "516"   "00063"
# "553"   "00063"
# "727"   "00063"
# "740"   "00063"
# "1009"  "00064"
# "165"   "00064"
# "334"   "00064"
# "416"   "00064"
# "468"   "00064"
# "486"   "00064"
# "595"   "00064"
# "60"    "00064"
# "616"   "00064"
# "619"   "00064"
# "887"   "00064"
# "959"   "00064"
# "108"   "00065"
# "128"   "00065"
# "145"   "00065"
# "171"   "00065"
# "345"   "00065"
# "387"   "00065"
# "488"   "00065"
# "672"   "00065"
# "1073"  "00066"
# "189"   "00066"
# "207"   "00066"
# "220"   "00066"
# "262"   "00066"
# "452"   "00066"
# "538"   "00066"
# "606"   "00066"
# "607"   "00066"
# "790"   "00066"
# "855"   "00066"
# "993"   "00066"
# "114"   "00067"
# "120"   "00067"
# "167"   "00067"
# "371"   "00067"
# "434"   "00067"
# "469"   "00067"
# "491"   "00067"
# "569"   "00067"
# "648"   "00067"
# "1035"  "00068"
# "392"   "00068"
# "487"   "00068"
# "497"   "00068"
# "505"   "00068"
# "80"    "00068"
# "934"   "00068"
# "160"   "00069"
# "19"    "00069"
# "384"   "00069"
# "633"   "00069"
# "687"   "00069"
# "780"   "00069"
# "409"   "00070"
# "558"   "00070"
# "647"   "00070"
# "707"   "00070"
# "106"   "00071"
# "277"   "00071"
# "463"   "00071"
# "544"   "00071"
# "949"   "00071"
# "141"   "00072"
# "20"    "00072"
# "354"   "00072"
# "513"   "00072"
# "650"   "00072"
# "713"   "00072"
# "101"   "00073"
# "1048"  "00073"
# "26"    "00073"
# "299"   "00073"
# "417"   "00073"
# "525"   "00073"
# "105"   "00074"
# "1101"  "00074"
# "221"   "00074"
# "461"   "00074"
# "311"   "00075"
# "627"   "00075"
# "871"   "00075"
# "969"   "00075"
# "401"   "00076"
# "724"   "00076"
# "778"   "00076"
# "1074"  "00077"
# "295"   "00077"
# "629"   "00077"
# "676"   "00077"
# "287"   "00078"
# "736"   "00078"
# "44"    "00079"
# "584"   "00079"
# "658"   "00079"
# "696"   "00079"
# "710"   "00079"
# "312"   "00080"
# "45"    "00080"
# "519"   "00080"
# "530"   "00080"
# "826"   "00080"
# "930"   "00080"
# "32"    "00081"
# "420"   "00081"
# "49"    "00081"
# "51"    "00081"
# "604"   "00081"
# "729"   "00081"
# "873"   "00081"
# "152"   "00082"
# "625"   "00082"
# "63"    "00082"
# "640"   "00082"
# "662"   "00082"
# "717"   "00082"
# "823"   "00082"
# "59"    "00083"
# "825"   "00083"
# "21"    "00084"
# "781"   "00084"
# "280"   "00085"
# "425"   "00085"
# "448"   "00085"
# "465"   "00085"
# "924"   "00085"
# "5"     "00086"
# "673"   "00086"
# "720"   "00086"
# "792"   "00086"
# "864"   "00086"
# "988"   "00086"
# "305"   "00087"
# "386"   "00087"
# "39"    "00087"
# "689"   "00087"
# "715"   "00087"
# "661"   "00088"
# "10"    "00089"
# "201"   "00089"
# "399"   "00089"
# "518"   "00089"
# "642"   "00089"
# "1039"  "00090"
# "3"     "00090"
# "458"   "00090"
# "506"   "00090"
# "652"   "00090"
# "338"   "00091"
# "517"   "00091"
# "52"    "00091"
# "636"   "00091"
# "693"   "00091"
# "831"   "00091"
# "163"   "00092"
# "17"    "00092"
# "212"   "00092"
# "549"   "00092"
# "578"   "00092"
# "744"   "00092"
# "1011"  "00093"
# "412"   "00093"
# "430"   "00093"
# "529"   "00093"
# "576"   "00093"
# "820"   "00093"
# "131"   "00095"
# "477"   "00095"
# "90"    "00095"
# "290"   "00096"
# "306"   "00096"
# "755"   "00096"
# "919"   "00096"
# "126"   "00097"
# "33"    "00097"
# "356"   "00097"
# "429"   "00097"
# "1014"  "00098"
# "155"   "00098"
# "507"   "00098"
# "436"   "00099"
# "1012"  "00100"
# "381"   "00100"
# "665"   "00100"
# "682"   "00100"
# "159"   "00101"
# "232"   "00101"
# "264"   "00101"
# "378"   "00101"
# "404"   "00101"
# "708"   "00101"
# "926"   "00101"
# "317"   "00102"
# "554"   "00102"
# "699"   "00102"
# "747"   "00102"
# "67"    "00103"
# "478"   "00104"
# "54"    "00104"
# "709"   "00104"
# "92"    "00104"
# "928"   "00104"
# "136"   "00105"
# "122"   "00106"
# "162"   "00106"
# "421"   "00106"
# "895"   "00106"
# "679"   "00107"
# "470"   "00108"
# "225"   "00109"
# "81"    "00110"
# "219"   "00111"
# "382"   "00111"
# "316"   "00112"
# "408"   "00112"
# "815"   "00112"
# "93"    "00112"
# "331"   "00113"
# "214"   "00114"
# "29"    "00114"
# "292"   "00114"
# "123"   "00115"
# "65"    "00115"
# "659"   "00115"
# "762"   "00115"
# "184"   "00116"
# "192"   "00116"
# "380"   "00116"
# "663"   "00116"
# "242"   "00117"
# "449"   "00117"
# "48"    "00117"
# "169"   "00118"
# "631"   "00119"
# "746"   "00119"
# "866"   "00119"
# "217"   "00120"
# "38"    "00120"
# "521"   "00120"
# "170"   "00121"
# "428"   "00121"
# "447"   "00121"
# "509"   "00121"
# "510"   "00121"
# "528"   "00121"
# "504"   "00122"
# "501"   "00123"
# "190"   "00124"
# "233"   "00124"
# "246"   "00124"
# "343"   "00124"
# "520"   "00124"
# "526"   "00124"
# "750"   "00124"
# "116"   "00125"
# "178"   "00125"
# "324"   "00125"
# "485"   "00125"
# "346"   "00126"
# "473"   "00126"
# "157"   "00127"
# "198"   "00127"
# "260"   "00127"
# "291"   "00127"
# "596"   "00127"
# "62"    "00127"
# "148"   "00128"
# "241"   "00128"
# "325"   "00128"
# "482"   "00128"
# "53"    "00128"
# "73"    "00128"
# "756"   "00128"
# "129"   "00129"
# "418"   "00129"
# "531"   "00129"
# "72"    "00129"
# "109"   "00130"
# "249"   "00130"
# "2"     "00131"
# "657"   "00131"
# "243"   "00132"
# "47"    "00133"
# "1047"  "00134"
# "213"   "00134"
# "303"   "00134"
# "68"    "00134"
# "205"   "00136"
# "223"   "00136"
# "270"   "00136"
# "879"   "00136"
# "1016"  "00137"
# "177"   "00137"
# "347"   "00137"
# "559"   "00137"
# "705"   "00137"
# "735"   "00137"
# "94"    "00137"
# "484"   "00138"
# "87"    "00138"
# "231"   "00142"
# "332"   "00143"
# "358"   "00143"
# "91"    "00143"
# "310"   "00145"
# "455"   "00145"
# "281"   "00146"
# "293"   "00147"
# "654"   "00147"
# "1028"  "00148"
# "156"   "00148"
# "42"    "00148"
# "462"   "00148"
# "304"   "00149"
# "55"    "00149"
# "763"   "00149"
# "239"   "00150"
# "86"    "00150"
# "164"   "00151"
# "550"   "00151"
# "77"    "00151"
# "498"   "00152"
# "431"   "00153"
# "660"   "00153"
# "31"    "00154"
# "690"   "00155"
# "240"   "00156"
# "150"   "00157"
# "193"   "00157"
# "685"   "00157"
# "252"   "00158"
# "472"   "00158"
# "248"   "00160"
# "315"   "00160"
# "476"   "00160"
# "227"   "00161"
# "259"   "00162"
# "285"   "00162"
# "410"   "00162"
# "443"   "00162"
# "66"    "00162"
# "411"   "00163"
# "523"   "00164"
# "692"   "00164"
# "739"   "00164"
# "199"   "00165"
# "226"   "00166"
# "319"   "00168"
# "582"   "00168"
# "321"   "00169"
# "628"   "00169"
# "684"   "00169"
# "188"   "00170"
# "367"   "00170"
# "402"   "00170"
# "451"   "00170"
# "137"   "00171"
# "218"   "00171"
# "229"   "00171"
# "433"   "00171"
# "651"   "00171"
# "133"   "00172"
# "255"   "00172"
# "99"    "00172"
# "511"   "00173"
# "154"   "00174"
# "24"    "00174"
# "432"   "00174"
# "326"   "00175"
# "327"   "00175"
# "58"    "00175"
# "83"    "00176"
# "845"   "00176"
# "283"   "00177"
# "419"   "00178"
# "591"   "00178"
# "479"   "00179"
# "480"   "00179"
# "566"   "00179"
# "514"   "00180"
# "732"   "00180"
# "751"   "00180"
# "203"   "00182"
# "23"    "00182"
# "14"    "00183"
# "13"    "00184"
# "147"   "00185"
# "124"   "00187"
# "307"   "00188"
# "340"   "00189"
# "274"   "00190"
# "209"   "00191"
# "393"   "00192"
# "284"   "00193"
# "298"   "00194"
# "474"   "00194"
# "527"   "00195"
# "250"   "00197"
# "134"   "00198"
# "272"   "00198"
# "230"   "00199"
# "208"   "00200"
# "403"   "00201"
# "515"   "00201"
# "588"   "00202"
# "200"   "00206"
# "211"   "00206"
# "597"   "00206"
# "175"   "00208"
# "385"   "00208"
# "187"   "00209"
# "4"     "00209"
# "603"   "00209"
# "271"   "00211"
# "215"   "00212"
# "88"    "00213"
# "508"   "00215"
# "435"   "00216"
# "235"   "00217"
# "322"   "00218"
# "427"   "00219"
# "678"   "00219"
# "8"     "00219"
# "95"    "00219"
# "161"   "00220"
# "71"    "00220"
# "179"   "00221"
# "180"   "00221"
# "471"   "00221"
# "143"   "00222"
# "273"   "00223"
# "182"   "00226"
# "265"   "00227"
# "655"   "00227"
# "301"   "00230"
# "568"   "00230"
# "496"   "00231"
# "282"   "00232"
# "11"    "00236"
# "185"   "00239"
# "197"   "00239"
# "245"   "00240"
# "323"   "00240"
# "194"   "00241"
# "144"   "00243"
# "483"   "00243"
# "125"   "00244"
# "228"   "00244"
# "132"   "00246"
# "153"   "00247"
# "475"   "00250"
# "186"   "00251"
# "196"   "00251"
# "333"   "00251"
# "70"    "00251"
# "546"   "00254"
# "268"   "00255"
# "238"   "00256"
# "97"    "00256"
# "135"   "00259"
# "289"   "00259"
# "82"    "00261"
# "357"   "00264"
# "12"    "00267"
# "742"   "00267"
# "275"   "00268"
# "111"   "00272"
# "89"    "00275"
# "191"   "00276"
# "28"    "00276"
# "202"   "00280"
# "234"   "00280"
# "64"    "00283"
# "176"   "00284"
# "216"   "00290"
# "183"   "00291"
# "118"   "00293"
# "15"    "00293"
# "25"    "00293"
# "328"   "00295"
# "96"    "00295"
# "22"    "00297"
# "302"   "00297"
# "276"   "00298"
# "318"   "00298"
# "9"     "00299"
# "423"   "00300"
# "195"   "00301"
# "257"   "00303"
# "269"   "00315"
# "168"   "00316"
# "748"   "00316"
# "69"    "00321"
# "173"   "00324"
# "151"   "00326"
# "210"   "00331"
# "79"    "00336"
# "405"   "00344"
# "204"   "00350"
# "313"   "00350"
# "222"   "00365"
# "172"   "00368"
# "117"   "00378"
# "237"   "00384"
# "98"    "00390"
# "7"     "00392"
# "56"    "00394"
# "127"   "00413"
# "174"   "00420"
# "121"   "00429"
# "300"   "00431"
# "1"     "00452"
# "288"   "00478"
# "286"   "00481"
# "294"   "00485"
# "181"   "00507"
# "100"   "00508"
# "258"   "00509"
# "50"    "00584"
